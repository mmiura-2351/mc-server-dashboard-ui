# トラブルシューティングガイド

このガイドは、マインクラフトサーバーダッシュボードでのよくある問題の診断と解決を支援します。

## 認証問題

### ログインできない

**症状**: 有効な認証情報でログインに失敗

**考えられる原因**:

- ユーザー名/パスワードが間違っている
- 管理者によるアカウント承認がされていない
- サーバー接続問題
- ブラウザキャッシュ/Cookie

**解決方法**:

1. 認証情報が正しいことを確認
2. アカウント承認状況について管理者に確認
3. ブラウザキャッシュとCookieをクリア
4. シークレット/プライベートブラウジングモードを試行
5. ブラウザコンソールでエラーメッセージを確認

### セッションがすぐに期限切れになる

**症状**: 頻繁なログアウト/再認証が必要

**考えられる原因**:

- JWTトークンの短い有効期限
- システムクロック問題
- ブラウザタイムゾーンの不一致

**解決方法**:

1. システムクロックの同期を確認
2. ブラウザを最新バージョンに更新
3. トークン有効期限設定について管理者に連絡

## サーバー管理問題

### サーバーが起動しない

**症状**: 開始ボタンが機能しない、またはサーバー起動に失敗

**考えられる原因**:

- 不十分なメモリ割り当て
- ポートが既に使用中
- 破損したサーバーファイル
- Java バージョン非互換
- 依存関係の不足

**解決方法**:

1. **サーバーログを確認**:

   ```
   サーバー → ログ → Latest に移動
   起動時のエラーメッセージを探す
   ```

2. **Java インストールを確認**:

   - 正しいJavaバージョンがインストールされていることを確認
   - Javaパス設定を確認

3. **ポート使用可能性を確認**:

   - 他のサービスがポートを使用していないことを確認
   - 異なるポート番号を試行

4. **メモリ問題**:

   - 割り当てRAMを増加
   - システム利用可能メモリを確認
   - 他のアプリケーションを終了

5. **ファイル破損**:
   - バックアップから復元
   - 必要に応じてワールドファイルを再生成

### サーバーが予期せず停止

**症状**: 実行中のサーバーが突然停止

**考えられる原因**:

- メモリ不足
- プラグイン/MODの致命的エラー
- システムリソース制限
- 電源管理問題

**解決方法**:

1. **クラッシュログを確認**:

   ```
   logs/ ディレクトリでクラッシュレポートを確認
   OutOfMemoryError や類似のエラーを探す
   ```

2. **メモリ管理**:

   - サーバーメモリ割り当てを増加
   - メモリ使用パターンを監視
   - メモリリークを確認

3. **プラグイン/MOD問題**:
   - 最近追加したプラグイン/MODを無効化
   - 最新バージョンに更新
   - 互換性を確認

### サーバーパフォーマンス不良

**症状**: 低TPS、ラグ、応答遅延

**考えられる原因**:

- 高サーバー負荷
- 非効率なプラグイン/MOD
- 大きなワールドファイル
- ネットワーク問題
- ハードウェア制限

**解決方法**:

1. **パフォーマンス分析**:

   - TPS監視（20であるべき）
   - メモリ使用量を確認
   - CPU使用率を確認

2. **最適化手順**:

   ```
   # 描画距離を削減
   view-distance=6

   # シミュレーション距離を制限
   simulation-distance=6

   # ガベージコレクションを最適化
   -XX:+UseG1GC -XX:+ParallelRefProcEnabled
   ```

3. **ワールド最適化**:
   - ワールドチャンクを事前生成
   - 不要な構造物を削除
   - エンティティをクリーンアップ

## ファイル管理問題

### アップロードが失敗

**症状**: ファイルアップロードが完了しない、またはエラー

**考えられる原因**:

- ファイルサイズが大きすぎる
- ネットワークタイムアウト
- ディスク容量不足
- 権限問題
- ブラウザ制限

**解決方法**:

1. **ファイルサイズを確認**:

   - ファイルがサイズ制限以下であることを確認
   - 大きなファイルにはZIP圧縮を使用

2. **ネットワーク問題**:

   - インターネット接続の安定性を確認
   - オフピーク時間にアップロードを試行
   - 大きなアップロードを小さなファイルに分割

3. **ストレージ容量**:
   - 利用可能ディスク容量を確認
   - 古いファイルをクリーンアップ
   - バックアップを外部ストレージに移動

### ファイルダウンロード問題

**症状**: ダウンロードが失敗、または破損

**考えられる原因**:

- ネットワーク中断
- サーバータイムアウト
- ファイル権限
- ブラウザダウンロード制限

**解決方法**:

1. **ダウンロード再試行**:

   - ダウンロードマネージャーを使用
   - 異なるブラウザを試行
   - インターネット接続を確認

2. **代替方法**:
   - 小さなファイルセクションをダウンロード
   - ZIP圧縮を使用
   - 異なる時間に試行

### ファイルが編集できない

**症状**: ファイルエディタが読み込まれない、または保存に失敗

**考えられる原因**:

- ファイル権限
- サーバーによるファイル使用中
- 大きなファイルサイズ
- ブラウザ制限

**解決方法**:

1. **権限確認**:

   - ユーザーに編集権限があることを確認
   - ファイル所有権を確認

2. **サーバーステータス**:

   - 重要なファイル編集前にサーバーを停止
   - ファイルロックの解除を待機

3. **ファイルサイズ**:
   - 大きなファイルには外部エディタを使用
   - 設定をより小さなファイルに分割

## ネットワークと接続問題

### サーバーに接続できない

**症状**: プレイヤーがマインクラフトサーバーに参加できない

**考えられる原因**:

- ファイアウォールが接続をブロック
- ポートフォワーディング問題
- IPアドレス変更
- サーバーオフライン

**解決方法**:

1. **サーバーステータスを確認**:

   - ダッシュボードでサーバーが「実行中」と表示されることを確認
   - 最初にローカル接続をテスト

2. **ネットワーク設定**:

   ```bash
   # ポートがリスニングしていることを確認
   netstat -an | grep :25565

   # ポートアクセシビリティをテスト
   telnet server-ip 25565
   ```

3. **ファイアウォール設定**:
   - ファイアウォールでポート25565を開放
   - ルーターポートフォワーディングを設定
   - クラウドプロバイダーセキュリティグループを確認

### ダッシュボードにアクセスできない

**症状**: ウェブダッシュボードにアクセスできない

**考えられる原因**:

- バックエンドAPIサーバーダウン
- ネットワーク接続性
- ブラウザ問題
- SSL証明書問題

**解決方法**:

1. **バックエンドステータスを確認**:

   - APIサーバーがポート8000で実行中であることを確認
   - バックエンドログでエラーを確認

2. **ネットワークトラブルシューティング**:

   ```bash
   # API接続をテスト
   curl http://localhost:8000/docs

   # ポート使用可能性を確認
   netstat -an | grep :8000
   ```

3. **ブラウザ問題**:
   - キャッシュとCookieをクリア
   - ブラウザ拡張機能を無効化
   - 異なるブラウザを試行

## グループ管理問題

### グループにプレイヤーを追加できない

**症状**: グループへのプレイヤー追加が失敗

**考えられる原因**:

- 無効なプレイヤー名
- プレイヤーが未登録
- 権限問題
- サーバーオフライン

**解決方法**:

1. **プレイヤー名を確認**:

   - 正確なスペルと大文字小文字を確認
   - プレイヤーが事前にサーバーに参加していることを確認

2. **サーバー要件**:

   - 一部の操作にはサーバーがオンラインである必要
   - グループ変更後にサーバー再起動

3. **権限確認**:
   - ユーザーにグループ管理権限があることを確認
   - グループ設定を確認

### グループ変更が適用されない

**症状**: グループ変更が反映されない

**考えられる原因**:

- サーバー未再起動
- 設定キャッシュ
- 権限競合

**解決方法**:

1. **サーバー再起動**:

   - サーバーを完全に停止・開始
   - 完全な初期化を待機

2. **キャッシュクリア**:
   - サーバーで権限を再読み込み
   - 利用可能な場合は `/reload` コマンドを使用

## バックアップと復元問題

### バックアップ作成が失敗

**症状**: バックアッププロセスが停止またはエラー

**考えられる原因**:

- ディスク容量不足
- 実行中サーバーからのファイルロック
- 権限問題
- 破損したファイル

**解決方法**:

1. **ストレージ確認**:

   - 十分な空き容量を確認
   - 古いバックアップをクリーンアップ

2. **サーバー状態**:

   - バックアップ前にサーバーを停止
   - すべてのプロセスの終了を待機

3. **ファイルアクセス**:
   - ファイル権限を確認
   - ロックされたファイルがないことを確認

### 復元が失敗

**症状**: バックアップ復元が完了しない

**考えられる原因**:

- 破損したバックアップファイル
- 容量不足
- 実行中サーバー
- 権限問題

**解決方法**:

1. **バックアップ確認**:

   - バックアップファイルの整合性をテスト
   - 異なるバックアップを試行

2. **準備**:
   - サーバーを完全に停止
   - 宛先ディレクトリをクリア
   - 権限を確認

## ブラウザとインターフェース問題

### ダッシュボードの読み込みが遅い

**症状**: ウェブインターフェースが遅い

**考えられる原因**:

- ネットワーク遅延
- 大きなログファイル
- ブラウザパフォーマンス
- サーバー過負荷

**解決方法**:

1. **ブラウザ最適化**:

   - 不要なタブを閉じる
   - ブラウザキャッシュをクリア
   - ブラウザを更新

2. **ネットワーク確認**:
   - 接続速度をテスト
   - 有線接続を試行
   - ネットワーク混雑を確認

### リアルタイム機能が動作しない

**症状**: ログが更新されない、ステータスが更新されない

**考えられる原因**:

- WebSocket接続問題
- ファイアウォールがWebSocketをブロック
- ブラウザ互換性

**解決方法**:

1. **WebSocketテスト**:

   - ブラウザコンソールでWebSocketエラーを確認
   - WebSocketサポートを確認

2. **ネットワーク設定**:
   - ファイアウォールがWebSocket接続を許可することを確認
   - プロキシ設定を確認

## 追加ヘルプの取得

### ログ分析

トラブルシューティング時は常にこれらのログを確認：

1. **サーバーログ**: `/logs/latest.log`
2. **ダッシュボードログ**: ブラウザコンソール
3. **システムログ**: サーバーシステムログ
4. **バックアップログ**: バックアップ操作ログ

### 一般的なログパターン

```
# メモリ不足
java.lang.OutOfMemoryError: Java heap space

# ポートバインドエラー
java.net.BindException: Address already in use

# 権限エラー
java.io.IOException: Permission denied

# 接続タイムアウト
java.net.SocketTimeoutException: Read timed out
```

### 問題報告

問題を報告する際は、以下を含めてください：

1. **エラーメッセージ**: 正確なエラーテキスト
2. **サーバー設定**: タイプ、バージョン、設定
3. **システム情報**: OS、Javaバージョン、メモリ
4. **再現手順**: 詳細な再現ステップ
5. **ログファイル**: 関連するログ抜粋

### 緊急時の復旧

ダッシュボードが使用不能になった場合：

1. **バックエンドアクセス**: サーバーに直接SSH
2. **手動サーバー制御**: コマンドラインを使用
3. **ファイル復旧**: ファイルに直接アクセス
4. **バックアップ復元**: 手動バックアップ復元

---

_最終更新: 2025年6月20日_
